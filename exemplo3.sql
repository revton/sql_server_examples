-- EXEMPLO DE GROUP BY
USE MASTER
GO
DROP DATABASE BANCO3;

CREATE DATABASE BANCO3
GO

USE BANCO3;

CREATE TABLE SERIALS
(
    ID INTEGER,
    CODIGO VARCHAR(MAX)
)

INSERT INTO SERIALS
VALUES (1, '97491874832789437904238489827408239')

INSERT INTO SERIALS
VALUES (2, '12348978578238578937583728958942378')

CREATE TABLE GENEROS
(
    ID INTEGER,
    NOME VARCHAR(50),
    DESCRICAO TEXT
)

INSERT INTO GENEROS (ID, NOME)
VALUES (1, 'Simulador')

INSERT INTO GENEROS
VALUES (2, 'Esporte', 'Ã‰ UM SPORT')

INSERT INTO GENEROS
VALUES (3, 'RPG', 'ROLE PLAYING GAME')

INSERT INTO GENEROS (ID, NOME)
VALUES (4, 'Battle Royale')

CREATE TABLE JOGOS 
(
    ID INTEGER,
    SERIAL_ID INTEGER,
    NOME VARCHAR(100),
    VALOR DECIMAL(28, 2),
    DATA_INCLUSAO DATETIME,
    DATA_COMPRADO DATETIME,
    DESCRICAO TEXT
)

INSERT INTO JOGOS (ID, NOME, VALOR, DATA_INCLUSAO, DATA_COMPRADO, DESCRICAO, SERIAL_ID)
VALUES(1, 'PES', 50.00, GETDATE(), NULL, 'O melhor jogo de futebol.', 1)

INSERT INTO JOGOS
VALUES(2, 2, 'LOL', 200.00, GETDATE(), NULL, 'O jogo mais famoso do mundo.')

INSERT INTO JOGOS
VALUES(3, NULL, 'Clash Royale', 10.00, GETDATE(), NULL, 'O jogo mais legal de Battle Royale.')

CREATE TABLE JOGO_GENEROS
(
    JOGO_ID INTEGER,
    GENERO_ID INTEGER
)

INSERT INTO JOGO_GENEROS (JOGO_ID, GENERO_ID)
VALUES (1, 1)

INSERT INTO JOGO_GENEROS
VALUES (1, 2)

INSERT INTO JOGO_GENEROS
VALUES (2, 3)

INSERT INTO JOGO_GENEROS
VALUES (3, 4)

INSERT INTO JOGO_GENEROS
VALUES (3, 1)

-- COUNT
SELECT
    JOGOS.NOME
    , COUNT(JOGO_GENEROS.GENERO_ID) AS QUANTIDADE_GENEROS
FROM
    JOGOS
    JOIN JOGO_GENEROS ON
            JOGO_GENEROS.JOGO_ID = JOGOS.ID   
GROUP BY
    JOGOS.NOME
HAVING
    COUNT(JOGO_GENEROS.GENERO_ID) > 1

-- SUM
SELECT
    GENEROS.NOME
    , SUM(JOGOS.VALOR) AS SOMA_VALOR
FROM
    GENEROS
    JOIN JOGO_GENEROS ON
            JOGO_GENEROS.GENERO_ID = GENEROS.ID
    JOIN JOGOS ON
            JOGOS.ID = JOGO_GENEROS.JOGO_ID
GROUP BY
    GENEROS.NOME    

-- AVG
-- MIN
-- MAX